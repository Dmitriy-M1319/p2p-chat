## P2P-чат с защищенным соединением
### High-level дизайн программы
* Подсистема соединения новых клиентов по сети, подключение новых клиентов и их отключение от чата.
* Установка защищенного TLS – соединения между каждым клиентом.
* Отправка сообщений – всем участникам в чате или приватного сообщения одному из клиентов.

### Подсистема подключения к сети клиентов
Для реализации данной подсистемы было разработано следующее решение: каждый клиент имеет в своей памяти список специальных структур, которые содержат в себе уникальный идентификатор клиента, о котором известно текущему клиенту (пусть это условно будет логином в сети),и объект самого соединения с этим клиентом. Имеется специальный широковещательный порт в локальной сети, который будет прослушиваться всеми клиентами, которые находятся в этой сети. 
#### Порядок подключения нового клиента к существующей сети:
1. Клиент, который не подключен в текущий момент, отправляет специальный пакет со своим идентификатором через широковещательный порт сети, таким образом создавая запрос на подключения к клиентам.
2. Если клиенты принимают этот запрос, то каждый устанавливает подключение  с новым: создается новый объект структуры подключения с каждой стороны.
3. После этого в списках подключения существовавших клиентов появится запись о новом клиенте, а в списке подключений нового клиента будут иметься все записи текущих клиентов. Подключение прошло успешно.

Для того, чтобы отключиться от сети, клиент проходится по списку подключений и каждому отправляет сообщение с данными  о том, что он принимает решение отключиться. Другая сторона принимает это решение, после чего разрывает соединение, удаляя в это же время из списка подключений объект структуры с этим клиентом. На отключаемом клиенте так же удаляется объект другой стороны, и так до тех пор, пока список не окажется пустым.

### Подсистема установки защищенного соединения
Для установки защищенного соединения будет использоваться протокол TLS v1.2. 
#### Этапы соединения клиентов:
1. Клиент, к которому пришел запрос на подключение, отправляет ответ, что можно подключаться.
2. Подключающийся клиент отправляет сообщение с алгоритмами шифрования, которые он может использовать для генерации ключей.
3. Клиент в сети отправляет выбранный алгоритм, на этом же этапе происходит обмен ключами.
4. После этого клиенты обмениваются цепочками сертификатов, и каждый проверяет их на подпись одним сгенерированным корневым сертификатом.
5. Затем происходит создание сеансового ключа на стороне подключаемого клиента с помощью открытого ключа.
6. Данный клиент уведомляет другую сторону о том, что создание сеансового ключа завершено и можно переходить на защищенное им соединение.
7. После этого клиент, к которому подключаются, восстанавливает сеансовый ключ и устанавливает зашифрованное соединение со своей стороны.

### Подсистема отправки сообщений
Благодаря тому, что у каждого клиента имеется список всех подключений, можно проводить рассылку сообщений несложным образом: для рассылки всем клиент проходится по всем объектам подключений и каждому отсылает набранное сообщение; если же необходима приватная рассылка, то дополнительно пользователь указывает логин клиента, которому надо отправить сообщение, после этого клиент в списке своих подключений ищет клиента с данным логином и отправляет сообщение только ему, иначе выдает ошибку о том, что такой адресат не найден.
